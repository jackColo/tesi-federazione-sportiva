@if(enrollment(); as enrl) {
<div class="max-w-4xl mx-auto space-y-6" [formGroup]="form">
  <div class="flex items-center gap-4">
    <a
      [routerLink]="enrollId() ? '../../'+enrl.eventId : '../../../'"
      class="p-2 rounded-full hover:bg-slate-100 text-slate-500 transition-colors"
    >
      <fa-icon [icon]="icons.faArrowLeft"></fa-icon>
    </a>

    <div class="flex-1">
      <div class="flex items-center gap-3">
        <h1 class="text-2xl text-slate-800">
          Iscrizione di
          <span class="font-bold">{{ enrl.athleteFirstname }} {{ enrl.athleteLastname }}</span>
        </h1>
      </div>
      <p class="text-slate-500 text-sm mt-1 flex items-center gap-2">
        <fa-icon [icon]="icons.faUsers" class="text-slate-400"></fa-icon>
        Dati atleta e dettagli competizione.
      </p>
    </div>

    <div class="ml-auto flex gap-2">
      @if (!isEditing) {
      <button
        (click)="toggleEdit()"
        class="text-blue-600 bg-blue-50 hover:bg-blue-100 transition-colors p-2 rounded-lg"
        title="Modifica Iscrizione"
      >
        <fa-icon [icon]="icons.faPen"></fa-icon>
      </button>
      } @else {
      <button
        (click)="saveChanges()"
        [disabled]="form.invalid"
        class="text-green-600 bg-green-50 hover:bg-green-100 transition-colors p-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed"
        title="Salva Modifiche"
      >
        <fa-icon [icon]="icons.faSave"></fa-icon>
      </button>
      <button
        (click)="cancelEdit()"
        class="text-slate-600 bg-slate-100 hover:bg-slate-200 transition-colors p-2 rounded-lg"
        title="Annulla"
      >
        <fa-icon [icon]="icons.faTimes"></fa-icon>
      </button>
      }
    </div>
  </div>

  <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
    <div class="p-8 border-b border-slate-100">
      <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
        <h3 class="font-bold text-slate-800 text-lg flex items-center gap-2">
          <div
            class="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center text-slate-500"
          >
            <fa-icon [icon]="icons.faTrophy" class="text-sm"></fa-icon>
          </div>
          Dati Iscrizione
        </h3>

        <div
          class="flex items-center gap-3 bg-slate-300/50 p-1.5 rounded-xl border border-transparent hover:border-slate-100 transition-colors"
        >
          <label
            class="text-[10px] font-bold uppercase text-slate-400 tracking-wider whitespace-nowrap pl-2"
          >
            Stato Iscrizione
          </label>

          <div class="relative">
            @if (isEditing) {<select
              formControlName="status"
              [attr.disabled]="!isEditing ? true : null"
              class="w-40 px-3 py-1.5 bg-white border border-slate-200 rounded-lg text-xs font-bold text-slate-700 shadow-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all disabled:bg-slate-100 disabled:text-slate-500 appearance-none cursor-pointer disabled:cursor-not-allowed"
              [class.border-blue-300]="isEditing"
            >
              @for (status of eStatus; track status) {
              <option [value]="status">{{ getReadableEnrollmentStatus(status) }}</option>
              }</select
            >} @else {
            <div
              class="w-full px-3 py-2 bg-slate-100 border border-slate-200 rounded-lg text-sm font-semibold text-slate-500 cursor-not-allowed"
            >
              {{ getReadableEnrollmentStatus(enrl.status) }}
            </div>
            }
          </div>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
            >Nome evento</label
          >
          <div
            class="w-full px-3 py-2 bg-slate-100 border border-slate-200 rounded-lg text-sm font-semibold text-slate-500 cursor-not-allowed"
          >
            {{ eventName }}
          </div>
        </div>
        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
          >
            Disciplina
          </label>
          <select
            formControlName="competitionType"
            [attr.disabled]="!isEditing ? true : null"
            class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm font-bold text-slate-700 shadow-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all disabled:bg-slate-50 disabled:text-slate-500 appearance-none"
          >
            @for (type of competitionTypes; track type) {
            <option [value]="type">{{ getReadableCompetitionType(type) }}</option>
            }
          </select>
        </div>

        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
            >Nome atleta</label
          >
          <div
            class="w-full px-3 py-2 bg-slate-100 border border-slate-200 rounded-lg text-sm font-semibold text-slate-500 cursor-not-allowed"
          >
            {{ enrl.athleteFirstname }}
          </div>
        </div>

        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
            >Cognome atleta</label
          >
          <div
            class="w-full px-3 py-2 bg-slate-100 border border-slate-200 rounded-lg text-sm font-semibold text-slate-500 cursor-not-allowed"
          >
            {{ enrl.athleteLastname }}
          </div>
        </div>

        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
          >
            Stato Affiliazione atleta @if(!isAffiliationValid(enrl.athleteAffiliationStatus)) {
            <span class="text-amber-600 ml-1 text-[10px]"> - Non Valido</span>
            }
          </label>
          <div
            class="w-full px-3 py-2 bg-slate-100 border border-slate-200 rounded-lg text-sm font-semibold text-slate-500 cursor-not-allowed"
            [ngClass]="
              isAffiliationValid(enrl.athleteMedicalCertificateExpireDate)
                ? 'bg-slate-100 border-slate-200 text-slate-500'
                : 'bg-amber-50 border-amber-200 text-amber-700'
            "
          >
            {{ getReadableAffiliationStatus(enrl.athleteAffiliationStatus) }}
            @if(!isAffiliationValid(enrl.athleteAffiliationStatus)) {
            <fa-icon class="text-amber-800" [icon]="icons.faExclamationTriangle"></fa-icon>
            }
          </div>
        </div>

        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
          >
            Scadenza Certificato atleta
            @if(isCertificateExpired(enrl.athleteMedicalCertificateExpireDate)) {
            <span class="text-amber-600 ml-1 text-[10px]"> - Scaduto </span>
            }
          </label>
          <div
            class="font-mono w-full px-3 py-2 border rounded-lg text-sm font-semibold flex items-center gap-2 cursor-not-allowed"
            [ngClass]="
              !isCertificateExpired(enrl.athleteMedicalCertificateExpireDate)
                ? 'bg-slate-100 border-slate-200 text-slate-500'
                : 'bg-amber-50 border-amber-200 text-amber-700'
            "
          >
            @if(isCertificateExpired(enrl.athleteMedicalCertificateExpireDate)) {
            <fa-icon [icon]="icons.faExclamationTriangle"></fa-icon>
            }
            {{ enrl.athleteMedicalCertificateExpireDate | date : 'dd/MM/yy' }}
          </div>
        </div>

        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
          >
            Peso atleta (kg)
          </label>
          <input
            type="number"
            formControlName="athleteWeight"
            [attr.disabled]="!isEditing ? true : null"
            class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm font-semibold text-slate-700 shadow-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all disabled:bg-slate-50 disabled:text-slate-500"
          />
        </div>

        <div class="group">
          <label
            class="block text-[10px] font-bold uppercase text-slate-400 mb-1 tracking-wider pl-1"
          >
            Altezza atleta (cm)
          </label>
          <input
            type="number"
            formControlName="athleteHeight"
            [attr.disabled]="!isEditing ? true : null"
            class="w-full px-3 py-2 bg-white border border-slate-200 rounded-lg text-sm font-semibold text-slate-700 shadow-sm focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 transition-all disabled:bg-slate-50 disabled:text-slate-500"
          />
        </div>
      </div>
    </div>
  </div>
</div>
}
